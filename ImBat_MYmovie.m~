
function ImBat_MYmovie(out,Y)


% find the first timestamp of the location data

[a b] = min(find(out.Location(:,1)~=0))
t = out.Location_time(a);



[minValue,closestIndex] = min(abs(t-out.video_times));


figure()
counter = 1;
mY = mean(Y(:,:,closestIndex:size(Y,3)),3);
Y = Y-mY;
% Y = mat2gray(Y);

fig = figure();
v = VideoWriter('peaks2.avi');
open(v);

for i = closestIndex:closestIndex+100 %size(Y,3);
    
    % step forward in video, find closest time in tracking
    [minValue,closestIndex] = min(abs(out.video_times(i)-out.Location_time));
    
    fC(counter,:) = out.Location(closestIndex,:);
    
    subplot(121)
    imagesc(Y(:,:,i),[-5 20]);
    colormap(gray);
    subplot(122);
    plot3(fC(:,1),fC(:,2),fC(:,3));
    counter = counter+1;
frame = getframe(fig);
   writeVideo(v,frame);
    pause(0.001);
end

close(v);
