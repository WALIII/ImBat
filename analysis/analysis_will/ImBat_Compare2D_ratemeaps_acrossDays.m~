
function [R] = ImBat_Compare2D_ratemeaps_acrossDays(FlightAlignedROI,roi2plot,split);


Flights = [];
Spikes =  [];
iii = 1;
days2use = unique(FlightAlignedROI{iii}.CutCells_date);

for iiii = 1:length(days2use);
    
    for ii = roi2plot;%1:size(CutCells,1);
        
        bound2use = 1:1400;
        
        cell2use = ii;
        ind2use = find(FlightAlignedROI{iii}.CutCells_date == days2use(iiii));
        
        if split == 1;
            ind2use = 1:2:length(ind2use);
        elseif split ==1;
            ind2use = 2:2:length(ind2use);
        else
        end
        
        
        % get flight data,
        ClustFlight = FlightAlignedROI{iii}.ClustFlight_withPads(:,:,ind2use);
        
        % upsample the calcium
        CutCells = FlightAlignedROI{iii}.S(:,:,ind2use);
        
        for i = 1: size(CutCells,3);
            
            bound2use = 1:1400;
            colormap(hot);
            trial2use = i;
            exampFlight = ClustFlight(bound2use,:,trial2use);
            exampCell = CutCells(cell2use,:,trial2use);
            exampCell = interp(exampCell,4);
            exampCell = exampCell(1:size(exampFlight,1));
            
            Flights = cat(1,Flights, exampFlight);
            Spikes = cat(1,Spikes, exampCell');
            
        end
    end

    
    % binarie spikes
    Spikes = zscore(Spikes);
    Spikes(Spikes>1) = 1;
    Spikes(Spikes<1) = 0;
    
    Spk = find(Spikes ==1);

    NormRateMat =  ImBat_2dHeatMap(Flights',Spk');
    figure(); imagesc(((NormRateMat')))
    Map2save(:,:,iiii) = NormRateMat';
    clear Spikes Flights exampCell CutCells exampFlight ind2use
   % re-initialize vars..
    Flights = [];
    Spikes = [];
    
end
    
% compare across days

% calculate the first, within day:

for iiii = 1:2
    
    for ii = roi2plot;%1:size(CutCells,1);
        
        bound2use = 1:1400;
        
        cell2use = ii;
        ind2use = find(FlightAlignedROI{iii}.CutCells_date == days2use(1));
        
        if iiii == 1;
            ind2use = 1:2:length(ind2use);
        elseif iiii ==2;
            ind2use = 2:2:length(ind2use);
        else
        end
        
        
        % get flight data,
        ClustFlight = FlightAlignedROI{iii}.ClustFlight_withPads(:,:,ind2use);
        
        % upsample the calcium
        CutCells = FlightAlignedROI{iii}.S(:,:,ind2use);
        
        for i = 1: size(CutCells,3);
            
            bound2use = 1:1400;
            colormap(hot);
            trial2use = i;
            exampFlight = ClustFlight(bound2use,:,trial2use);
            exampCell = CutCells(cell2use,:,trial2use);
            exampCell = interp(exampCell,4);
            exampCell = exampCell(1:size(exampFlight,1));
            
            Flights = cat(1,Flights, exampFlight);
            Spikes = cat(1,Spikes, exampCell');
            
        end
    end

    
    % binarie spikes
    Spikes = zscore(Spikes);
    Spikes(Spikes>1) = 1;
    Spikes(Spikes<1) = 0;
    
    Spk = find(Spikes ==1);

    NormRateMat =  ImBat_2dHeatMap(Flights',Spk');
    figure(); imagesc(((NormRateMat')))
    Map2save(:,:,iiii) = NormRateMat';
    clear Spikes Flights exampCell CutCells exampFlight ind2use
   % re-initialize vars..
    Flights = [];
    Spikes = [];
    
end
    


for i = 1:size(Map2save,3)
R(i) = corr2(squeeze(Map2save(:,:,1)),squeeze(Map2save(:,:,i)));
end
figure(); plot(R);

