function ImBat_PlotSegTraces(neuron, out, out_traj)


% Run after:
% [out_traj] =  ImBat_SegTrajectories(out.Location,out.Location_time)



% optional: add jitter to location:
for i = 1:3;
out.Location_jitter(:,i) = smooth(out.Location(:,i)+ randi(100,length(out.Location),1)/1,10);
out.Location(:,i) = smooth(out.Location(:,i),10);
end



%Using subplots, show:
% 1: the velocity/accel of the bat
% 2: average population activity ( smoothed, average of the
    % z-score-normalized data- will be usefull for finding 'replay' events
    % later on...
% 3: plotting individual neuron timeeries (z-scored) ( top 40)

figure(); 
hold on;

a1 = subplot(10,1,1); 
hold on;
D = diff(nanmean(out.Location2(:,1:3),2));
plot(out.Location_time(1:end-1),(abs(D)))

a2 = subplot(10,1,2); 
hold on;
plot(out.video_times(1:end-1),zscore(smooth(mean((full(neuron.S(1:50,1:end-1))),1),100)));
ylim([0 5]);

a3 = subplot(10,1,3:10);
hold on;
for i = 1: 40; 
    hh = movmean(neuron.C_raw(i,:),4);
plot(out.video_times,zscore(hh)+i*4);
end
  linkaxes([a1, a2, a3], 'x');
 
  